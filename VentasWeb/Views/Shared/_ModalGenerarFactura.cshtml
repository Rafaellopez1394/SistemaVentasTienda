<!-- Modal Generar Factura - Agregar a Views/Venta/Index.cshtml o VentaPOS/Index.cshtml -->

<!-- Modal Generar Factura Electrónica -->
<div class="modal fade" id="modalGenerarFactura" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">
                    <i class="fas fa-file-invoice"></i> Generar Factura Electrónica CFDI 4.0
                </h5>
                <button type="button" class="close text-white" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="hdnVentaID" />
                
                <!-- Resumen de la venta -->
                <div class="alert alert-info">
                    <strong>Ticket:</strong> <span id="lblVentaFecha"></span> |
                    <strong>Total:</strong> <span id="lblVentaTotal"></span>
                </div>
                
                <div class="row">
                    <!-- Datos del Receptor -->
                    <div class="col-md-12">
                        <h6 class="border-bottom pb-2 mb-3">Datos del Receptor</h6>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>RFC del Receptor <span class="text-danger">*</span></label>
                            <input type="text" id="txtRFC" class="form-control text-uppercase" 
                                   maxlength="13" placeholder="XAXX010101000"
                                   style="text-transform: uppercase;">
                            <small class="form-text text-muted">
                                RFC a 12 (Persona Moral) o 13 caracteres (Persona Física)
                            </small>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Nombre / Razón Social <span class="text-danger">*</span></label>
                            <input type="text" id="txtNombreReceptor" class="form-control" 
                                   placeholder="Nombre completo o razón social">
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Uso de CFDI <span class="text-danger">*</span></label>
                            <select id="cboUsoCFDI" class="form-control">
                                <option value="">Seleccione...</option>
                            </select>
                            <small class="form-text text-muted">
                                ¿Para qué utilizará el cliente esta factura?
                            </small>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Régimen Fiscal <span class="text-danger">*</span></label>
                            <select id="cboRegimenFiscal" class="form-control">
                                <option value="">Seleccione...</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="form-group">
                            <label>Código Postal <span class="text-danger">*</span></label>
                            <input type="text" id="txtCP" class="form-control" 
                                   maxlength="5" placeholder="00000">
                            <small class="form-text text-muted">CP del domicilio fiscal</small>
                        </div>
                    </div>
                    
                    <div class="col-md-8">
                        <div class="form-group">
                            <label>Email (Opcional)</label>
                            <input type="email" id="txtEmailReceptor" class="form-control" 
                                   placeholder="receptor@ejemplo.com">
                            <small class="form-text text-muted">
                                Se enviará el XML y PDF automáticamente
                            </small>
                        </div>
                    </div>
                    
                    <!-- Datos de Pago -->
                    <div class="col-md-12">
                        <h6 class="border-bottom pb-2 mb-3 mt-3">Datos de Pago</h6>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Forma de Pago <span class="text-danger">*</span></label>
                            <select id="cboFormaPago" class="form-control">
                                <option value="">Seleccione...</option>
                                <option value="01">01 - Efectivo</option>
                                <option value="03">03 - Transferencia electrónica de fondos</option>
                                <option value="04">04 - Tarjeta de crédito</option>
                                <option value="28">28 - Tarjeta de débito</option>
                                <option value="99">99 - Por definir</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Método de Pago</label>
                            <select id="cboMetodoPago" class="form-control" disabled>
                                <option value="PUE" selected>PUE - Pago en una sola exhibición</option>
                                <option value="PPD">PPD - Pago en parcialidades o diferido</option>
                            </select>
                            <small class="form-text text-muted">
                                Por defecto: Pago en una sola exhibición
                            </small>
                        </div>
                    </div>
                </div>
                
                <!-- Advertencias -->
                <div class="alert alert-warning mt-3">
                    <i class="fas fa-exclamation-triangle"></i>
                    <strong>Importante:</strong> Verifique que todos los datos sean correctos antes de generar la factura. 
                    Una vez timbrada, solo podrá cancelarse en un plazo de 72 horas.
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button type="button" id="btnGenerarFactura" class="btn btn-primary" onclick="procesarFacturacion()">
                    <i class="fas fa-file-invoice"></i> Generar Factura
                </button>
            </div>
        </div>
    </div>
</div>

<style>
    #modalGenerarFactura .form-control:focus {
        border-color: #007bff;
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
    }
    
    #modalGenerarFactura .text-danger {
        color: #dc3545 !important;
    }
    
    #modalGenerarFactura small.form-text {
        font-size: 0.85rem;
        color: #6c757d;
    }
</style>
